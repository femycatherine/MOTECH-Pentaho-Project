{
   "_id": "_design/events",
   "fulltext": {
       "by_timeStamp": {
           "defaults": {
               "store": "yes"
           },
           "index": "function (doc){if(doc.type!='CouchEventLog'){return null;}var ret=new Array();var timeStamp=new Date(doc.timeStamp);var timeStampString=doc.timeStamp;var eventSubject=doc.subject;var motechId='';function newDocument(dataName,dataValue){if(null==dataValue){dataValue='missing';}var d=new Document();d.add(timeStamp,{type:'date',field:'timeStamp'});d.add(timeStampString,{type:'string',field:'timeStampString'});d.add(motechId,{type:'string',field:'motechId'});d.add(dataName,{type:'string',field:'dataName'});d.add(dataValue,{type:'string',field:'dataValue'});return d;}if(doc.subject==='org.motechproject.commcare.api.formstub'){for(caseIndex in doc.parameters.caseIds){motechId=doc.parameters.caseIds[caseIndex];ret[caseIndex*2]=newDocument('commcareReceivedOn',doc.parameters.receivedOn);ret[caseIndex*2+1]=newDocument('commcareFormId',doc.parameters.formId);}}else{if(doc.subject==='org.motechproject.messagecampaign.enrolled-user'){motechId=doc.parameters.ExternalID;ret[0]=newDocument('messageCampaignName',doc.parameters.CampaignName);}else{if(doc.subject==='org.motechproject.messagecampaign.fired-campaign-message'){motechId=doc.parameters.ExternalID;ret[0]=newDocument('messageCampaignName',doc.parameters.CampaignName);ret[1]=newDocument('schedulerJobId',doc.parameters.JobID);}else{if(doc.subject==='org.motechproject.mrs.api.Patient.Created'){motechId=doc.parameters.MotechId;ret[0]=newDocument('personId',doc.parameters.PersonId);ret[1]=newDocument('patientId',doc.parameters.PatientId);ret[2]=newDocument('facilityId',doc.parameters.FacilityId);}else{if(doc.subject.indexOf('org.motechproject.icappr')>=0){if('motechId' in doc.parameters){motechId=doc.parameters.motechId;if('JobID' in doc.parameters){ret[ret.length+1]=newDocument('schedulerJobId',doc.parameters.JobID);}if('PhoneNum' in doc.parameters){ret[ret.length+1]=newDocument('callPhoneNumber',doc.parameters.PhoneNum);}if('stop_date' in doc.parameters){ret[ret.length+1]=newDocument('stopDate',doc.parameters.stop_date);}}}}}}}if(ret.length>0){ret.splice(0,0,newDocument('eventSubject',eventSubject));}return ret;}"
       }
   }
}
