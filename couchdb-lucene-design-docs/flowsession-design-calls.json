{
   "_id": "_design/calls",
   "fulltext": {
       "by_call": {
           "defaults": {
               "store": "yes"
           },
           "index": "function(doc){if(doc.type!='FlowSessionRecord'){return null;}var callStartDate=new Date();var callEndDate=new Date();var callStartDateString='missing';var callDuration='missing';var motechId='missing';var phoneNumber='missing';var callDisposition='UNKNOWN';var callSid='missing';if('startDate' in doc.callDetailRecord&&doc.callDetailRecord.startDate){callStartDate=new Date(doc.callDetailRecord.startDate);callStartDateString=doc.callDetailRecord.startDate;}if('endDate' in doc.callDetailRecord&&doc.callDetailRecord.endDate){callEndDate=new Date(doc.callDetailRecord.endDate);}if('duration' in doc.callDetailRecord&&doc.callDetailRecord.duration){callDuration=doc.callDetailRecord.duration;}if('phoneNumber' in doc.callDetailRecord&&doc.callDetailRecord.phoneNumber){phoneNumber=doc.callDetailRecord.phoneNumber;}if('disposition' in doc.callDetailRecord&&doc.callDetailRecord.disposition){callDisposition=doc.callDetailRecord.disposition;}for(index in doc.callDetailRecord.callEvents){var event=doc.callDetailRecord.callEvents[index];if(event.name==='Pin Failure'){callDisposition='AUTHENTICATION_FAILED';}}if('CallSid' in doc.data&&doc.data.CallSid){callSid=doc.data.CallSid;}if('motechId' in doc.data&&doc.data.motechId){motechId=doc.data.motechId;}var ret=new Document();ret.add(callStartDate,{type:'date',field:'callStartDate'});ret.add(callEndDate,{type:'date',field:'callEndDate'});ret.add(callStartDateString,{type:'string',field:'callStartDateString'});ret.add(callDuration,{type:'string',field:'callDuration'});ret.add(motechId,{type:'string',field:'motechId'});ret.add(phoneNumber,{type:'string',field:'phoneNumber'});ret.add(callDisposition,{type:'string',field:'callDisposition'});ret.add(callSid,{type:'string',field:'callSid'});return ret;}"
       }
   }
}
