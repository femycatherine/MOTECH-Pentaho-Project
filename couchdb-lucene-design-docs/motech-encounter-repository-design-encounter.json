{
   "_id": "_design/encounter",
   "fulltext": {
       "by_concept": {
           "defaults": {
               "store": "yes"
           },
           "index": "function (doc){if(doc.type!='Encounter'){return null;}var ret=new Document();ret.add(doc.observations.length,{'field':'numAnswers','type':'int'});ret.add(doc.encounterType,{'field':'encounterType'});ret.add(new Date(doc.encounterDate),{'type':'date','field':'encounterDate'});ret.add(doc.encounterDate,{'field':'dateString'});ret.add(doc.encounterPatientId,{'field':'patientId'});ret.add(doc.encounterId,{'field':'encounterId'});var answer='no concern';if(doc.encounterType==='Stop Request Encounter'){answer=doc.observations[0].value;}else{var baseName='org.motechproject.icappr.';var concerningObservations=[baseName.concat('PatientSelectedYesYellowSkinOrEyes'),baseName.concat('PatientSelectedYesSkinRashOrItchySkin'),baseName.concat('PatientSelectedYesAbdominalPainOrVomiting'),baseName.concat('PatientSelectedYesTinglingOrNumbnessOfHandsOrFeet'),baseName.concat('NoMedicationYesterday'),baseName.concat('NoMedicationTwoDaysAgo'),baseName.concat('NoMedicationThreeDaysAgo'),baseName.concat('PatientConcernsAdherence'),baseName.concat('PatientConcernsAppointment'),baseName.concat('PinFailure')];for each(obs in doc.observations){log.info(obs.value);if(concerningObservations.indexOf(obs.conceptName)>=0){answer='yes';break;}}}ret.add(answer,{'field':'answer'});return ret;}"
       }
   }
}
